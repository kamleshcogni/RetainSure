<app-sidebar></app-sidebar>

<!-- Main Content -->
<main class="main">
  <!-- Page Header -->
  <header class="page-header">
    <div class="page-header__titles">
      <h3 class="page-subtitle">Insurance Retention &amp; Performance Overview</h3>
    </div>

    <div class="page-header__controls">
      <label class="sr-only" for="dateRange">Date range</label>
      <select id="dateRange" class="select" disabled>
        <option>Last 7 Days</option>
        <option selected>Last 30 Days</option>
        <option>This Month</option>
      </select>
    </div>
  </header>

  <!-- Loading / Error state (simple) -->
  <section *ngIf="loading" class="p-3 text-muted">
    Loading analytics...
  </section>

  <!-- KPI Cards -->
  <section *ngIf="!loading" class="kpi-grid" aria-label="Key Metrics">
    <!-- 1 -->
    <div class="kpi-card">
      <div class="kpi-card__title">Renewal Rate</div>
      <div class="kpi-card__value">{{ vm?.renewalRatePct ?? 0 }}%</div>
      <div class="kpi-card__desc">Percentage of policies renewed</div>
    </div>

    <!-- 2 -->
    <div class="kpi-card">
      <div class="kpi-card__title">Churn Rate</div>
      <div class="kpi-card__value">{{ vm?.churnRatePct ?? 0 }}%</div>
      <div class="kpi-card__desc">Customers not renewing</div>
    </div>

    <!-- 3 -->
    <div class="kpi-card">
      <div class="kpi-card__title">High Risk Customers</div>
      <div class="kpi-card__value">{{ vm?.highRiskCustomers ?? 0 }}</div>
      <div class="kpi-card__desc">Flagged by risk models</div>
    </div>

    <!-- 4 -->
    <div class="kpi-card">
      <div class="kpi-card__title">Predictions Run Today</div>
      <div class="kpi-card__value">
        {{ vm?.predictionsRunToday ?? 0 }} / {{ vm?.predictionsTotal ?? 0 }}
      </div>
      <div class="kpi-card__desc">Execution progress for today</div>
      <div class="progress">
        <div
          class="progress__bar"
          [style.width.%]="
            vm && vm.predictionsTotal
              ? (vm.predictionsRunToday / vm.predictionsTotal) * 100
              : 0
          "
        ></div>
      </div>
    </div>

    <!-- 5 -->
    <div class="kpi-card">
      <div class="kpi-card__title">Engagement Response Rate</div>
      <div class="kpi-card__value">{{ vm?.engagementResponseRatePct ?? 0 }}%</div>
      <div class="kpi-card__desc">Responses to outreach</div>
    </div>

    <!-- 6 -->
    <div class="kpi-card">
      <div class="kpi-card__title">Campaign ROI</div>
      <div class="kpi-card__value">{{ vm?.campaignRoiPct ?? 0 }}%</div>
      <div class="kpi-card__desc">Return on latest campaigns</div>
    </div>

    <!-- 7 -->
    <div class="kpi-card">
      <div class="kpi-card__title">Upcoming Expiries (30 Days)</div>
      <div class="kpi-card__value">{{ vm?.upcomingExpiries30Days ?? 0 }}</div>
      <div class="kpi-card__desc">Policies expiring within 30 days</div>
    </div>

    <!-- 8 -->
    <div class="kpi-card">
      <div class="kpi-card__title">Average Risk Score</div>
      <div class="kpi-card__value">{{ vm?.averageRiskScore ?? 0 }} / 100</div>
      <div class="kpi-card__desc">Portfolio risk index</div>
      <div class="meter">
        <div class="meter__fill" [style.width.%]="vm?.averageRiskScore ?? 0"></div>
      </div>
    </div>
  </section>

  <!-- Charts Section -->
  <section *ngIf="!loading" class="charts" aria-label="Charts">
    <!-- Renewal Trend -->
    <div class="chart-card">
      <div class="chart-card__header">
        <h3>Renewal Trend</h3>
      </div>
      <div class="chart-container">
        <canvas #renewalCanvas class="chart-canvas" aria-label="Renewal Trend chart"></canvas>
      </div>
    </div>

    <!-- Churn by Policy Type -->
    <div class="chart-card">
      <div class="chart-card__header">
        <h3>Churn by Policy Type</h3>
      </div>
      <div class="chart-container">
        <canvas #churnCanvas class="chart-canvas" aria-label="Churn by Policy Type chart"></canvas>
      </div>
    </div>

    <!-- Customer Risk Distribution -->
    <div class="chart-card">
      <div class="chart-card__header">
        <h3>Customer Risk Distribution</h3>
      </div>
      <div class="chart-container">
        <canvas #riskCanvas class="chart-canvas" aria-label="Customer Risk Distribution chart"></canvas>
      </div>
    </div>
  </section>

  <!-- Reports Section -->
  <section *ngIf="!loading" class="reports" aria-label="Reports">
    <div class="section-header">
      <h2>Reports</h2>
    </div>

    <div class="table-wrap">
      <table class="report-table">
        <thead>
          <tr>
            <th>Report Name</th>
            <th>Report Type</th>
            <th>Generated Date</th>
            <th>Status</th>
            <th class="align-right">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Monthly Retention Report</td>
            <td>PDF</td>
            <td>-</td>
            <td><span class="badge badge--success">Ready</span></td>
            <td class="align-right">
              <button class="btn btn--Secondary" type="button" (click)="download('pdf')">Download</button>
            </td>
          </tr>
          <tr>
            <td>Campaign Performance Report</td>
            <td>Excel</td>
            <td>-</td>
            <td><span class="badge badge--success">Ready</span></td>
            <td class="align-right">
              <button class="btn btn--Secondary" type="button" (click)="download('excel')">Download</button>
            </td>
          </tr>
          <tr>
            <td>Churn Analysis Report</td>
            <td>CSV</td>
            <td>-</td>
            <td><span class="badge badge--success">Ready</span></td>
            <td class="align-right">
              <button class="btn btn--Secondary" type="button" (click)="download('csv')">Download</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</main>